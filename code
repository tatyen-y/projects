import requests
import uuid
import json

# Установите ваши авторизационные данные
client_secret = "c1e9501f-0a26-4d4a-a86a-5c1797dceb75"
authorization_data = "ZmQyODg0NzEtZDhjMy00MWJkLWFlYjktNmY0NDUxNDNhMDljOmMxZTk1MDFmLTBhMjYtNGQ0YS1hODZhLTVjMTc5N2RjZWI3NQ=="

# Функция для получения токена доступа
def get_access_token(client_secret, authorization_data):
    url = "https://ngw.devices.sberbank.ru:9443/api/v2/oauth"
    headers = {
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept": "application/json",
        "Authorization": f"Basic {authorization_data}",
        "RqUID": str(uuid.uuid4())
    }
    data = "scope=GIGACHAT_API_PERS"
    response = requests.post(url, headers=headers, data=data, verify=False)
    
    if response.status_code == 200:
        return response.json()["access_token"]
    else:
        raise Exception(f"Failed to get access token: {response.status_code}, {response.text}")

# Получите токен доступа
access_token = get_access_token(client_secret, authorization_data)
print("Access Token:", access_token)

# Функция для генерации текста с помощью GigaChat
def generate_text(access_token, prompt, model_id="GigaChat-Pro"):
    url = "https://gigachat.devices.sberbank.ru/api/v1/chat/completions"
    headers = {
        "Content-Type": "application/json",
        "Accept": "application/json",
        "Authorization": f"Bearer {access_token}"
    }
    data = {
        "model": model_id,  # Используйте выбранный ID модели
        "messages": [
            {
                "role": "user",
                "content": prompt
            }
        ],
        "temperature": 1.0,
        "top_p": 0.1,
        "n": 1,
        "stream": False,
        "max_tokens": 512,
        "repetition_penalty": 1
    }
    
    response = requests.post(url, headers=headers, json=data, verify=False)
    
    if response.status_code == 200:
        return response.json()
    else:
        raise Exception(f"Failed to generate text: {response.status_code}, {response.text}")

# Пример использования функции для генерации текста
prompt = "Ты знаешь биографии известных людей?"
response = generate_text(access_token, prompt)
print("GigaChat Response:", json.dumps(response, indent=4, ensure_ascii=False))
